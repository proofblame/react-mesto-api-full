{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _toConsumableArray from\"/Users/timurmarokko/Desktop/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/timurmarokko/Desktop/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/timurmarokko/Desktop/dev/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{Route,Switch}from'react-router-dom';import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import ImagePopup from\"./ImagePopup\";import api from\"../utils/api\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import ConfirmPopup from\"./ConfirmPopup\";import AddPlacePopup from\"./AddPlacePopup\";import Register from\"./Register\";import Login from\"./Login\";import ProtectedRoute from\"./ProtectedRoute\";import MainRoute from'./MainRoute';import auth from\"../utils/auth\";function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditProfilePopupOpen=_useState2[0],setIsEditProfilePopupOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isAddPlacePopupOpen=_useState4[0],setIsAddPlacePopupOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isEditAvatarPopupOpen=_useState6[0],setIsEditAvatarPopupOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isConfirmPopupOpen=_useState8[0],setIsConfirmPopupOpen=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),selectedCard=_useState10[0],setSelectedCard=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),deleteCard=_useState12[0],setDeleteCard=_useState12[1];var _useState13=useState({}),_useState14=_slicedToArray(_useState13,2),currentUser=_useState14[0],setCurrentUser=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),cards=_useState16[0],setCards=_useState16[1];var _useState17=useState({submit:\"Сохранить\",confirm:\"Да\"}),_useState18=_slicedToArray(_useState17,2),valueInput=_useState18[0],setValueInput=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),nameError=_useState20[0],setNameError=_useState20[1];var _useState21=useState(\"\"),_useState22=_slicedToArray(_useState21,2),descriptionError=_useState22[0],setDescriptionError=_useState22[1];var _useState23=useState(false),_useState24=_slicedToArray(_useState23,2),formValid=_useState24[0],setFormValid=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),nameValid=_useState26[0],setNameValid=_useState26[1];var _useState27=useState(false),_useState28=_slicedToArray(_useState27,2),descriptionValid=_useState28[0],setDescriptionValid=_useState28[1];var _useState29=useState(false),_useState30=_slicedToArray(_useState29,2),loggedIn=_useState30[0],setLoggedIn=_useState30[1];var _useState31=useState({}),_useState32=_slicedToArray(_useState31,2),user=_useState32[0],setUser=_useState32[1];var _useState33=useState(false),_useState34=_slicedToArray(_useState33,2),isChecked=_useState34[0],setIsChecked=_useState34[1];// Проверка токена\nfunction checkToken(){var jwt=localStorage.getItem(\"jwt\");if(jwt){auth.getUserData(jwt).then(function(res){setLoggedIn(true);setUser({email:res.data.email,id:res.data._id});}).catch(function(e){return console.error(e.message);}).finally(function(){setIsChecked(true);});}else{setIsChecked(true);}}// Валидация изменения имени и названия\nfunction handleChangeName(event){if(event.target.validity.valid){setNameError(\"\");setNameValid(true);}else{setNameError(event.target.validationMessage);setNameValid(false);}}// Валидация изменения описания и ссылок\nfunction handleChangeDescription(event){if(event.target.validity.valid){setDescriptionError(\"\");setDescriptionValid(true);}else{setDescriptionError(event.target.validationMessage);setDescriptionValid(false);}}useEffect(function(){if(!nameValid||!descriptionValid){setFormValid(false);}else{setFormValid(true);}return function(){setFormValid(false);};},[nameValid,descriptionValid]);// useEffect(() => {\n//     if (nameError || descriptionError) {\n//         setFormValid(false);\n//     } else {\n//         setFormValid(true);\n//     }\n// },[nameError, descriptionError]);\n// Получение данных пользователя, карточек с сервера\nuseEffect(function(){checkToken();api.getUserInfo().then(function(data){setCurrentUser(data);}).catch(function(err){console.log(err);});api.getInitialCards().then(function(cards){setCards(cards);}).catch(function(err){console.log(err);});},[]);//  Закрытие попапа по Esc и клику на оверлей\nuseEffect(function(){function handleEscClose(event){if(event.key===\"Escape\"){closeAllPopups();}}function handleClickOnOverlay(event){var popup=document.querySelector(\".popup_opened\");if(event.target!==popup){return;}closeAllPopups();}document.addEventListener(\"click\",handleClickOnOverlay);document.addEventListener(\"keydown\",handleEscClose);return function(){document.removeEventListener(\"keydown\",handleEscClose);document.removeEventListener(\"click\",handleClickOnOverlay);};},[]);//  Поставить/снять лайк\nfunction handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});api.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){var newCards=cards.map(function(c){return c._id===card._id?newCard:c;});setCards(newCards);}).catch(function(err){console.log(err);});}//  Удалить карточку\nfunction handleCardDelete(card){setValueInput(_objectSpread(_objectSpread({},valueInput),{},{confirm:\"Удаление...\"}));api.deleteCard(card._id).then(function(){var newCards=cards.filter(function(c){return c._id!==card._id;});setCards(newCards);}).then(function(){closeAllPopups();setValueInput(_objectSpread(_objectSpread({},valueInput),{},{confirm:\"Да\"}));}).catch(function(err){console.log(err);});}//  Добавить карточку\nfunction handleAddPlaceSubmit(_ref){var name=_ref.name,link=_ref.link;setValueInput(_objectSpread(_objectSpread({},valueInput),{},{submit:\"Сохранение...\"}));api.addNewCard(name,link).then(function(card){setCards([card].concat(_toConsumableArray(cards)));}).then(function(){setValueInput(_objectSpread(_objectSpread({},valueInput),{},{submit:\"Сохранить\"}));closeAllPopups();}).catch(function(err){console.log(err);});}//  Обновить аватар\nfunction handleUpdateAvatar(_ref2){var avatar=_ref2.avatar;setValueInput(_objectSpread(_objectSpread({},valueInput),{},{submit:\"Сохранение...\"}));api.setUserAvatar(avatar).then(function(){setCurrentUser(_objectSpread(_objectSpread({},currentUser),{},{avatar:avatar}));}).then(function(){closeAllPopups();setValueInput(_objectSpread(_objectSpread({},valueInput),{},{submit:\"Сохранить\"}));}).catch(function(err){console.log(err);});}//  Обновить данные пользователя\nfunction handleUpdateUser(_ref3){var name=_ref3.name,about=_ref3.about;setValueInput(_objectSpread(_objectSpread({},valueInput),{},{submit:\"Сохранение...\"}));api.setUserInfo(name,about).then(function(){setCurrentUser(_objectSpread(_objectSpread({},currentUser),{},{name:name,about:about}));}).then(function(){closeAllPopups();setValueInput(_objectSpread(_objectSpread({},valueInput),{},{submit:\"Сохранить\"}));}).catch(function(err){console.log(err);});}//  Присвоить значения карточке\nfunction handleCardClick(card){setSelectedCard(card);}//  Открыть попап редактирования профиля\nfunction handleEditProfileClick(){setIsEditProfilePopupOpen(true);}//  Открыть попап добавдения новой карточки\nfunction handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}//  Открыть попап редактирования аватара\nfunction handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);setNameValid(true);}//  Открыть попап подтверждения удаления карточки\nfunction handleDeleteButtonClick(card){setIsConfirmPopupOpen(true);setDeleteCard(card);setNameValid(true);setDescriptionValid(true);}//  Закрыть все попапы\nfunction closeAllPopups(){setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setIsEditAvatarPopupOpen(false);setSelectedCard(false);setIsConfirmPopupOpen(false);setNameValid(false);setDescriptionValid(false);}function handleRegister(email,password){return auth.register(email,password);}function handleLogin(email,password){return auth.login(email,password).then(function(res){localStorage.setItem(\"jwt\",res.token);});}function handleSignout(){localStorage.clear();setLoggedIn(false);}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"root\",children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,email:user.email,onSignout:handleSignout}),/*#__PURE__*/_jsx(MainRoute,{isChecked:isChecked,children:/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{onLogin:handleLogin,loggedIn:loggedIn,checkToken:checkToken})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{onRegister:handleRegister,loggedIn:loggedIn})}),/*#__PURE__*/_jsx(ProtectedRoute,{loggedIn:loggedIn,path:\"/\",component:Main,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onCardClick:handleCardClick,cards:cards,onCardLike:handleCardLike,onConfirmDelete:handleDeleteButtonClick,handleChangeName:handleChangeName})]})}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(ConfirmPopup,{isOpen:isConfirmPopupOpen,onClose:closeAllPopups,onCardDelete:handleCardDelete,card:deleteCard,valueInput:valueInput.confirm,formValid:formValid}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit,valueInput:valueInput.submit,nameError:nameError,descriptionError:descriptionError,handleChangeName:handleChangeName,handleChangeDescription:handleChangeDescription,formValid:formValid}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar,valueInput:valueInput.submit,descriptionError:descriptionError,handleChangeDescription:handleChangeDescription,formValid:formValid}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser,valueInput:valueInput.submit,nameError:nameError,descriptionError:descriptionError,handleChangeName:handleChangeName,handleChangeDescription:handleChangeDescription,formValid:formValid}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups})]})});}export default App;","map":{"version":3,"sources":["/Users/timurmarokko/Desktop/dev/react-mesto-auth/src/components/App.js"],"names":["React","useState","useEffect","Route","Switch","Header","Main","Footer","EditProfilePopup","EditAvatarPopup","ImagePopup","api","CurrentUserContext","ConfirmPopup","AddPlacePopup","Register","Login","ProtectedRoute","MainRoute","auth","App","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isConfirmPopupOpen","setIsConfirmPopupOpen","selectedCard","setSelectedCard","deleteCard","setDeleteCard","currentUser","setCurrentUser","cards","setCards","submit","confirm","valueInput","setValueInput","nameError","setNameError","descriptionError","setDescriptionError","formValid","setFormValid","nameValid","setNameValid","descriptionValid","setDescriptionValid","loggedIn","setLoggedIn","user","setUser","isChecked","setIsChecked","checkToken","jwt","localStorage","getItem","getUserData","then","res","email","data","id","_id","catch","e","console","error","message","finally","handleChangeName","event","target","validity","valid","validationMessage","handleChangeDescription","getUserInfo","err","log","getInitialCards","handleEscClose","key","closeAllPopups","handleClickOnOverlay","popup","document","querySelector","addEventListener","removeEventListener","handleCardLike","card","isLiked","likes","some","i","changeLikeCardStatus","newCard","newCards","map","c","handleCardDelete","filter","handleAddPlaceSubmit","name","link","addNewCard","handleUpdateAvatar","avatar","setUserAvatar","handleUpdateUser","about","setUserInfo","handleCardClick","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleDeleteButtonClick","handleRegister","password","register","handleLogin","login","setItem","token","handleSignout","clear"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Route, Switch } from 'react-router-dom';\nimport Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport ImagePopup from \"./ImagePopup\";\nimport api from \"../utils/api\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport ConfirmPopup from \"./ConfirmPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport Register from \"./Register\";\nimport Login from \"./Login\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport MainRoute from './MainRoute';\nimport auth from \"../utils/auth\";\n\nfunction App() {\n    const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n    const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n    const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n    const [isConfirmPopupOpen, setIsConfirmPopupOpen] = useState(false);\n    const [selectedCard, setSelectedCard] = useState(false);\n    const [deleteCard, setDeleteCard] = useState(false);\n    const [currentUser, setCurrentUser] = useState({});\n    const [cards, setCards] = useState([]);\n    const [valueInput, setValueInput] = useState({\n        submit: \"Сохранить\",\n        confirm: \"Да\"\n    });\n\n    const [nameError, setNameError] = useState(\"\");\n    const [descriptionError, setDescriptionError] = useState(\"\");\n    const [formValid, setFormValid] = useState(false);\n    const [nameValid, setNameValid] = useState(false);\n    const [descriptionValid, setDescriptionValid] = useState(false);\n    const [loggedIn, setLoggedIn] = useState(false);\n    const [user, setUser] = useState({})\n    const [isChecked, setIsChecked] = useState(false);\n\n    // Проверка токена\n    function checkToken() {\n        const jwt = localStorage.getItem(\"jwt\");\n        if (jwt) {\n            auth.getUserData(jwt)\n                .then((res) => {\n                    setLoggedIn(true);\n                    setUser({\n                        email: res.data.email,\n                        id: res.data._id\n                    });\n                })\n                .catch((e) => console.error(e.message))\n                .finally(() => {\n                    setIsChecked(true);\n                });\n        } else {\n            setIsChecked(true);\n        }\n    }\n\n    // Валидация изменения имени и названия\n    function handleChangeName(event) {\n        if (event.target.validity.valid) {\n            setNameError(\"\");\n            setNameValid(true);\n        } else {\n            setNameError(event.target.validationMessage);\n            setNameValid(false);\n        }\n    }\n    // Валидация изменения описания и ссылок\n    function handleChangeDescription(event) {\n        if (event.target.validity.valid) {\n            setDescriptionError(\"\");\n            setDescriptionValid(true);\n        } else {\n            setDescriptionError(event.target.validationMessage);\n            setDescriptionValid(false);\n        }\n    }\n\n    useEffect(() => {\n        if (!nameValid || !descriptionValid) {\n            setFormValid(false);\n        } else {\n            setFormValid(true);\n        }\n        return () => {\n            setFormValid(false);\n        };\n    }, [nameValid, descriptionValid]);\n\n    // useEffect(() => {\n    //     if (nameError || descriptionError) {\n    //         setFormValid(false);\n    //     } else {\n    //         setFormValid(true);\n    //     }\n    // },[nameError, descriptionError]);\n\n    // Получение данных пользователя, карточек с сервера\n    useEffect(() => {\n        checkToken();\n        api.getUserInfo()\n            .then((data) => {\n                setCurrentUser(data);\n            })\n            .catch((err) => {\n                console.log(err);\n            });\n        api.getInitialCards()\n            .then((cards) => {\n                setCards(cards);\n            })\n            .catch((err) => {\n                console.log(err);\n            });\n    }, []);\n\n    //  Закрытие попапа по Esc и клику на оверлей\n    useEffect(() => {\n        function handleEscClose(event) {\n            if (event.key === \"Escape\") {\n                closeAllPopups();\n            }\n        }\n\n        function handleClickOnOverlay(event) {\n            const popup = document.querySelector(\".popup_opened\");\n            if (event.target !== popup) {\n                return;\n            }\n            closeAllPopups();\n        }\n\n        document.addEventListener(\"click\", handleClickOnOverlay);\n        document.addEventListener(\"keydown\", handleEscClose);\n\n        return () => {\n            document.removeEventListener(\"keydown\", handleEscClose);\n            document.removeEventListener(\"click\", handleClickOnOverlay);\n        };\n    }, []);\n\n    //  Поставить/снять лайк\n    function handleCardLike(card) {\n        const isLiked = card.likes.some((i) => i._id === currentUser._id);\n\n        api.changeLikeCardStatus(card._id, !isLiked)\n            .then((newCard) => {\n                const newCards = cards.map((c) =>\n                    c._id === card._id ? newCard : c\n                );\n                setCards(newCards);\n            })\n            .catch((err) => {\n                console.log(err);\n            });\n    }\n\n    //  Удалить карточку\n    function handleCardDelete(card) {\n        setValueInput({\n            ...valueInput,\n            confirm: \"Удаление...\"\n        });\n        api.deleteCard(card._id)\n            .then(() => {\n                const newCards = cards.filter((c) => c._id !== card._id);\n                setCards(newCards);\n            })\n            .then(() => {\n                closeAllPopups();\n                setValueInput({\n                    ...valueInput,\n                    confirm: \"Да\"\n                });\n            })\n            .catch((err) => {\n                console.log(err);\n            });\n    }\n\n    //  Добавить карточку\n    function handleAddPlaceSubmit({ name, link }) {\n        setValueInput({\n            ...valueInput,\n            submit: \"Сохранение...\"\n        });\n        api.addNewCard(name, link)\n            .then((card) => {\n                setCards([card, ...cards]);\n            })\n            .then(() => {\n                setValueInput({\n                    ...valueInput,\n                    submit: \"Сохранить\"\n                });\n                closeAllPopups();\n            })\n            .catch((err) => {\n                console.log(err);\n            });\n    }\n    //  Обновить аватар\n    function handleUpdateAvatar({ avatar }) {\n        setValueInput({\n            ...valueInput,\n            submit: \"Сохранение...\"\n        });\n        api.setUserAvatar(avatar)\n            .then(() => {\n                setCurrentUser({\n                    ...currentUser,\n                    avatar: avatar\n                });\n            })\n            .then(() => {\n                closeAllPopups();\n                setValueInput({\n                    ...valueInput,\n                    submit: \"Сохранить\"\n                });\n            })\n            .catch((err) => {\n                console.log(err);\n            });\n    }\n    //  Обновить данные пользователя\n    function handleUpdateUser({ name, about }) {\n        setValueInput({\n            ...valueInput,\n            submit: \"Сохранение...\"\n        });\n        api.setUserInfo(name, about)\n            .then(() => {\n                setCurrentUser({\n                    ...currentUser,\n                    name: name,\n                    about: about\n                });\n            })\n            .then(() => {\n                closeAllPopups();\n                setValueInput({\n                    ...valueInput,\n                    submit: \"Сохранить\"\n                });\n            })\n            .catch((err) => {\n                console.log(err);\n            });\n    }\n\n    //  Присвоить значения карточке\n    function handleCardClick(card) {\n        setSelectedCard(card);\n    }\n\n    //  Открыть попап редактирования профиля\n    function handleEditProfileClick() {\n        setIsEditProfilePopupOpen(true);\n    }\n    //  Открыть попап добавдения новой карточки\n    function handleAddPlaceClick() {\n        setIsAddPlacePopupOpen(true);\n    }\n    //  Открыть попап редактирования аватара\n    function handleEditAvatarClick() {\n        setIsEditAvatarPopupOpen(true);\n        setNameValid(true);\n    }\n    //  Открыть попап подтверждения удаления карточки\n    function handleDeleteButtonClick(card) {\n        setIsConfirmPopupOpen(true);\n        setDeleteCard(card);\n        setNameValid(true);\n        setDescriptionValid(true);\n    }\n    //  Закрыть все попапы\n    function closeAllPopups() {\n        setIsEditProfilePopupOpen(false);\n        setIsAddPlacePopupOpen(false);\n        setIsEditAvatarPopupOpen(false);\n        setSelectedCard(false);\n        setIsConfirmPopupOpen(false);\n        setNameValid(false);\n        setDescriptionValid(false);\n    }\n\n    function handleRegister(email, password) {\n        return auth.register(email, password);\n    }\n\n    function handleLogin(email, password) {\n        return auth.login(email, password).then((res) => {\n            localStorage.setItem(\"jwt\", res.token);\n        });\n    }\n\n    function handleSignout() {\n        localStorage.clear();\n        setLoggedIn(false);\n    }\n\n    return (\n        <CurrentUserContext.Provider value={currentUser}>\n            <div className=\"root\">\n                <Header\n                    loggedIn={loggedIn}\n                    email={user.email}\n                    onSignout={handleSignout}\n                />\n                <MainRoute isChecked={isChecked}>\n                    <Switch>\n                        <Route path=\"/sign-in\">\n                            <Login\n                                onLogin={handleLogin}\n                                loggedIn={loggedIn}\n                                checkToken={checkToken}\n                            />\n                        </Route>\n                        <Route path=\"/sign-up\">\n                            <Register\n                                onRegister={handleRegister}\n                                loggedIn={loggedIn}\n                            />\n                        </Route>\n                        <ProtectedRoute\n                            loggedIn={loggedIn}\n                            path=\"/\"\n                            component={Main}\n                            onEditProfile={handleEditProfileClick}\n                            onAddPlace={handleAddPlaceClick}\n                            onEditAvatar={handleEditAvatarClick}\n                            onCardClick={handleCardClick}\n                            cards={cards}\n                            onCardLike={handleCardLike}\n                            onConfirmDelete={handleDeleteButtonClick}\n                            handleChangeName={handleChangeName}\n                        />\n                    </Switch>\n                </MainRoute>\n                <Footer />\n                <ConfirmPopup\n                    isOpen={isConfirmPopupOpen}\n                    onClose={closeAllPopups}\n                    onCardDelete={handleCardDelete}\n                    card={deleteCard}\n                    valueInput={valueInput.confirm}\n                    formValid={formValid}\n                />\n                <AddPlacePopup\n                    isOpen={isAddPlacePopupOpen}\n                    onClose={closeAllPopups}\n                    onAddPlace={handleAddPlaceSubmit}\n                    valueInput={valueInput.submit}\n                    nameError={nameError}\n                    descriptionError={descriptionError}\n                    handleChangeName={handleChangeName}\n                    handleChangeDescription={handleChangeDescription}\n                    formValid={formValid}\n                />\n                <EditAvatarPopup\n                    isOpen={isEditAvatarPopupOpen}\n                    onClose={closeAllPopups}\n                    onUpdateAvatar={handleUpdateAvatar}\n                    valueInput={valueInput.submit}\n                    descriptionError={descriptionError}\n                    handleChangeDescription={handleChangeDescription}\n                    formValid={formValid}\n                />\n                <EditProfilePopup\n                    isOpen={isEditProfilePopupOpen}\n                    onClose={closeAllPopups}\n                    onUpdateUser={handleUpdateUser}\n                    valueInput={valueInput.submit}\n                    nameError={nameError}\n                    descriptionError={descriptionError}\n                    handleChangeName={handleChangeName}\n                    handleChangeDescription={handleChangeDescription}\n                    formValid={formValid}\n                />\n\n                <ImagePopup card={selectedCard} onClose={closeAllPopups} />\n            </div>\n        </CurrentUserContext.Provider>\n    );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}